cmake_minimum_required(VERSION 3.18)

project("LiQuiBit")

if(CMAKE_CURRENT_BINARY_DIR STREQUAL CMAKE_CURRENT_SOURCE_DIR)
  set(CMAKE_CURRENT_BINARY_DIR "${CMAKE_CURRENT_BINARY_DIR}/build")
endif()

if(CMAKE_EXTRA_GENERATOR)
    set (GENERATOR "${CMAKE_EXTRA_GENERATOR} - ${CMAKE_GENERATOR}")
else()
    set (GENERATOR "${CMAKE_GENERATOR}")
endif(CMAKE_EXTRA_GENERATOR)

set(SUB_IOT_SOURCE "${CMAKE_CURRENT_SOURCE_DIR}/Sub-IoT-Stack/stack")

set(BUILD_PUSH7 "${CMAKE_CURRENT_BINARY_DIR}/Push7")
execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_PUSH7})
execute_process(
    WORKING_DIRECTORY ${BUILD_PUSH7}
    COMMAND ${CMAKE_COMMAND} -G "${GENERATOR}"
    -D PLATFORM=PUSH7
    -D APP_PUSH7_BUTTON=y
    -D CMAKE_BUILD_TYPE=Debug
    ${SUB_IOT_SOURCE}
)

add_custom_target(push7 ALL
    WORKING_DIRECTORY ${BUILD_PUSH7}
    COMMAND ${CMAKE_MAKE_PROGRAM} -j push7_button.elf
)


